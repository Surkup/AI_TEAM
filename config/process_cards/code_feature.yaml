# Code Feature Implementation Process Card
# Multi-step process: design → code → test → review
#
# This card demonstrates:
# - Technical workflow for coding tasks
# - Multiple agent collaboration
# - Quality gates

metadata:
  id: "card-code-feature-001"
  name: "code_feature"
  version: "1.0"
  description: "Implement a code feature with design, coding, testing, and review"
  author: "ai_team"

spec:
  variables:
    feature_description: ""
    design_doc: null
    code_output: null
    test_results: null
    review_result: null

  steps:
    # Step 1: Design the feature
    - id: "step_design"
      action: "generate_text"
      params:
        prompt: "Design a software feature: ${input.feature}\n\nProvide:\n1. Technical approach\n2. Components needed\n3. API design\n4. Edge cases"
        max_tokens: 1000
      output: design_doc
      timeout_seconds: 120

    # Step 2: Generate code
    - id: "step_code"
      action: "generate_text"
      params:
        prompt: "Based on this design:\n${design_doc}\n\nWrite Python code to implement: ${input.feature}"
        max_tokens: 2000
      output: code_output
      timeout_seconds: 180

    # Step 3: Generate tests
    - id: "step_test"
      action: "generate_text"
      params:
        prompt: "Write pytest tests for this code:\n${code_output}\n\nCover edge cases and main functionality."
        max_tokens: 1500
      output: test_results
      timeout_seconds: 120

    # Step 4: Review
    - id: "step_review"
      action: "review_text"
      params:
        text: "${code_output}"
        criteria:
          - "correctness"
          - "security"
          - "performance"
          - "maintainability"
      output: review_result
      timeout_seconds: 120

    # Step 5: Save artifacts
    # Note: With DummyAgent, variables contain dict. Using string descriptions for testing.
    # With real AI agents, you would use ${variable} directly for text content.
    - id: "step_save_design"
      action: "file_storage"
      params:
        path: "/features/${input.feature_name}/design.md"
        content: "# Feature Design: ${input.feature}\n\nGenerated by AI_TEAM code_feature pipeline."

    - id: "step_save_code"
      action: "file_storage"
      params:
        path: "/features/${input.feature_name}/implementation.py"
        content: "# Implementation for: ${input.feature}\n# Generated by AI_TEAM"

    - id: "step_save_tests"
      action: "file_storage"
      params:
        path: "/features/${input.feature_name}/test_implementation.py"
        content: "# Tests for: ${input.feature}\n# Generated by AI_TEAM"

    # Step 6: Complete
    - id: "step_complete"
      type: "complete"
      status: "success"
      result:
        design: "${design_doc}"
        code: "${code_output}"
        tests: "${test_results}"
        review: "${review_result}"
