# Research Report Process Card
# Multi-step process: research → analyze → write → review
#
# This card demonstrates:
# - Research-based workflow
# - Data gathering and analysis
# - Report generation

metadata:
  id: "card-research-001"
  name: "research_report"
  version: "1.0"
  description: "Generate a research report with data gathering, analysis, and writing"
  author: "ai_team"

spec:
  variables:
    topic: ""
    research_data: null
    analysis: null
    report_draft: null
    final_report: null

  steps:
    # Step 1: Research the topic
    - id: "step_research"
      action: "research"
      params:
        topic: "${input.topic}"
        depth: "comprehensive"
        sources: 5
      output: research_data
      timeout_seconds: 180
      retry:
        max_attempts: 2
        delay_seconds: 5

    # Step 2: Analyze findings
    - id: "step_analyze"
      action: "generate_text"
      params:
        prompt: "Analyze this research data about '${input.topic}':\n\n${research_data}\n\nProvide:\n1. Key findings\n2. Trends\n3. Gaps in knowledge\n4. Recommendations"
        max_tokens: 1500
      output: analysis
      timeout_seconds: 120

    # Step 3: Write report draft
    - id: "step_write"
      action: "generate_text"
      params:
        prompt: "Write a professional research report about '${input.topic}'.\n\nResearch:\n${research_data}\n\nAnalysis:\n${analysis}\n\nFormat:\n1. Executive Summary\n2. Introduction\n3. Methodology\n4. Findings\n5. Analysis\n6. Conclusions\n7. Recommendations"
        max_tokens: 3000
      output: report_draft
      timeout_seconds: 300

    # Step 4: Review and improve
    - id: "step_review"
      action: "review_text"
      params:
        text: "${report_draft}"
        criteria:
          - "accuracy"
          - "completeness"
          - "clarity"
          - "structure"
      output: review_result

    # Step 5: Final polish
    - id: "step_improve"
      action: "improve_text"
      params:
        text: "${report_draft}"
        feedback: "${review_result}"
        style: "professional"
      output: final_report
      timeout_seconds: 180

    # Step 6: Save report
    # Note: Using string description for DummyAgent compatibility
    - id: "step_save"
      action: "file_storage"
      params:
        path: "/reports/${input.topic}_report.md"
        content: "# Research Report: ${input.topic}\n\nGenerated by AI_TEAM research pipeline."

    # Step 7: Complete
    - id: "step_complete"
      type: "complete"
      status: "success"
      result: "${final_report}"
