# Content Pipeline Process Card
# Multi-step content creation with quality gates
#
# This card demonstrates:
# - Content creation pipeline
# - Quality iteration loop
# - Conditional branching

metadata:
  id: "card-content-001"
  name: "content_pipeline"
  version: "1.0"
  description: "Create content with quality checks and iteration"
  author: "ai_team"

spec:
  variables:
    content_type: ""
    topic: ""
    draft: null
    quality_score: null
    final_content: null
    iteration_count: 0

  steps:
    # Step 1: Generate initial draft
    - id: "step_draft"
      action: "generate_text"
      params:
        prompt: "Create ${input.content_type} about: ${input.topic}\n\nRequirements:\n- Engaging and informative\n- Clear structure\n- Target audience: ${input.audience}"
        max_tokens: 2000
      output: draft
      timeout_seconds: 180

    # Step 2: Quality check
    - id: "step_quality"
      action: "review_text"
      params:
        text: "${draft}"
        criteria:
          - "engagement"
          - "accuracy"
          - "structure"
          - "grammar"
      output: quality_score
      timeout_seconds: 60

    # Step 3: Decision - good enough?
    - id: "step_decision"
      condition: "${quality_score.score} >= 7"
      then: "step_finalize"
      else: "step_improve"

    # Step 4a: Improve if needed
    - id: "step_improve"
      action: "improve_text"
      params:
        text: "${draft}"
        feedback: "${quality_score.feedback}"
      output: draft
      next: "step_quality"  # Loop back

    # Step 4b: Finalize if good
    - id: "step_finalize"
      action: "generate_text"
      params:
        prompt: "Polish and finalize this ${input.content_type}:\n\n${draft}\n\nAdd:\n- Compelling headline\n- Strong conclusion\n- Call to action if appropriate"
        max_tokens: 2500
      output: final_content
      timeout_seconds: 120

    # Step 5: Save
    # Note: Using string description for DummyAgent compatibility
    - id: "step_save"
      action: "file_storage"
      params:
        path: "/content/${input.content_type}/${input.topic}.md"
        content: "# ${input.content_type}: ${input.topic}\n\nGenerated by AI_TEAM content pipeline."

    # Step 6: Complete
    - id: "step_complete"
      type: "complete"
      status: "success"
      result:
        content: "${final_content}"
        quality_score: "${quality_score}"
