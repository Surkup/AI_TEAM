# Динамика "мозга" Оркестратора — Три режима мышления (v0.1)

**Дата**: 2025-12-17
**Автор**: Коллеги (обсуждение)
**Статус**: ЧЕРНОВИК

---

> **ВНИМАНИЕ: ЧЕРНОВИК**
>
> Этот документ является черновиком и требует:
> 1. Детальной проработки каждого пункта
> 2. Проверки на соответствие SSOT документации проекта
> 3. Утверждения перед интеграцией в основную документацию
>
> **НЕ ЯВЛЯЕТСЯ** частью SSOT. Идеи могут противоречить текущей архитектуре.
>
> **Требуется сверка с**:
> - [ORCHESTRATOR_SPEC_v1.0.md](../../SSOT/ORCHESTRATOR_SPEC_v1.0.md)
> - [PROCESS_CARD_SPEC_v1.0.md](../../SSOT/PROCESS_CARD_SPEC_v1.0.md)
> - [NODE_REGISTRY_SPEC_v1.0.md](../../SSOT/NODE_REGISTRY_SPEC_v1.0.md)

---

## Контекст

Если «тело» системы (паспорта, схемы данных, структура карточек) уже материализовано в документации, то здесь описывается **динамика** — как «мозг» (Оркестратор) прогоняет данные через эти структуры.

**Ключевой инсайт**: «мозг» в данном понимании — это не просто распределитель задач, а **хранитель целостности** (Integrity Guard).

---

## 1. Рекурсивная декомпозиция (Top-Down)

Когда приходит задача «Сделать ПО», Оркестратор не просто ищет агентов, он выполняет **«каскадное раскрытие»**:

1. Сначала он разворачивает Process Card верхнего уровня.
2. Видит в ней пустые слоты для данных (например, `technical_stack = null`).
3. Формирует «подзадачу-исследование» (пункт 3 черновика), чтобы заполнить эти переменные в SSOT.

**Логика**: Оркестратор не переходит к шагу N, пока переменные шага N-1 в реестре проекта не будут валидированы.

---

## 2. Петля контроля качества (The Quality Loop)

Для «мозга» это выглядит как **цикл обратной связи** (Feedback Loop):

```
┌─────────────┐
│  Dispatch   │ ← Отправка задачи согласно Passport агента
└──────┬──────┘
       ▼
┌─────────────┐
│   Ingest    │ ← Получение результата
└──────┬──────┘
       ▼
┌─────────────┐
│  Evaluate   │ ← Вызов агента-критика (или автоматические тесты)
└──────┬──────┘
       ▼
┌─────────────────────────────────────────────────────┐
│              DECISION TREE                          │
├─────────────────────────────────────────────────────┤
│ Quality >= Threshold                                │
│   → Merge в SSOT (завершение шага)                  │
├─────────────────────────────────────────────────────┤
│ Quality < Threshold AND Attempts < Max              │
│   → Retry с передачей лога критики                  │
├─────────────────────────────────────────────────────┤
│ Quality < Threshold AND Attempts >= Max             │
│   → Эскалация (Блокер)                              │
└─────────────────────────────────────────────────────┘
```

---

## 3. Наблюдаемость и Самонаблюдение (Self-Reflection)

Это самая важная часть «мозга» для **эволюции системы**.

### Принципы:

- Процессор должен не просто вести лог, а **маркировать причинно-следственные связи**.
- Пример: «Шаг 5 занял 10 итераций, потому что в Шаге 2 была допущена неопределенность в SSOT».
- После завершения проекта «мозг» генерирует **«Посмертный отчет»** (Post-mortem), который автоматически предлагает правки в Process Card или Node Passport.

### Пример улучшения:
> "Повысить требования к компетенциям для этапа X, так как статистика показала 70% retry rate"

---

## 4. Боевой сценарий для проверки логики

**Задача**: «Разработать модуль авторизации для нового ПО»

### Вопросы для валидации архитектуры:

1. **Как Оркестратор поймет, какую именно Process Card достать?**
   - По типу задачи? По ключевым словам? По явному указанию?

2. **Как он определит из Node Registry, что Agent_A подходит?**
   - Через какие поля паспорта происходит matching?
   - `capabilities`? `labels`? `role`?

3. **В какой момент он поймет, что пора звать человека?**
   - Превышение бюджета итераций?
   - Превышение денежного бюджета?
   - Логический тупик (цикл без прогресса)?
   - Этический фильтр?

---

## Связанные документы

- [ORCHESTRATOR_SPEC_v1.0.md](../../SSOT/ORCHESTRATOR_SPEC_v1.0.md)
- [NODE_REGISTRY_SPEC_v1.0.md](../../SSOT/NODE_REGISTRY_SPEC_v1.0.md)
- [PROCESS_CARD_SPEC_v1.0.md](../../SSOT/PROCESS_CARD_SPEC_v1.0.md)
